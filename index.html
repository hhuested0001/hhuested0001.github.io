<!doctype html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.2/handlebars.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  
  <meta charset="UTF-8">
  <title>Program 5</title>
</head>

<body>
  <h1>Select a Major</h1>
  
  <button type='button' onClick="getData('CIT')">CIT Majors</button>
  <button type='button' onClick="getData('BUS')">BUS Majors</button>
  
  <h3>We filter our dataset by major</h3>
  
  <div id="studentTable"></div> <!-- this is where the table will go -->

</body>  
  
  <!--handlebars template-->
  <script type="text/x-handlebars-template" id="tableTemplate">
  <table>
  <tr><th>Name</th><th>Major</th><th>Midterm</th><th>Final</th></tr>
  {{#each rows}}
    <tr>
      <td>{{name}}</td><td>{{major}}</td><td>{{midterm}}</td><td>{{final}}</td>
    </tr>
  {{/each}}
  </table>
  </script>
  
  <!-- Ajax code -->
  <script>
   
  function getData(selected_major) {
    var request = new XMLHttpRequest();
    request.open('GET', 'cit5students.json');
    
    request.onload = function(){
      var data = JSON.parse(request.responseText);
      
      student_items = data.filter(getMajor)
      function getMajor(item){
        return item.major == selected_major;
      }
      
      if(request.status == 200) {
        var templateText = document.getElementById('tableTemplate').innerHTML;
        var compiledTemplateText = Handlebars.compile(templateText);
        compiledHTML = compiledTemplateText({rows: student_items})
        document.getElementById('studentTable').innerHTML = compiledHTML;  
      }
      else {
        document.getElementById('studentTable').innerHTML = "There was an error!";
      }
    }
    request.send(null);
  }
  
  </script>
</html>
